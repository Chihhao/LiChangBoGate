# LiChangBoGate - é‡Œé•·ä¼¯ç¤¾å€é™æ§å™¨

`LiChangBoGate` æ˜¯ä¸€å€‹æ™ºæ…§ç¤¾å€é–€ç¦æ§åˆ¶ç³»çµ±ï¼Œå®ƒå…è¨±å·²æˆæ¬Šçš„ä½æˆ¶é€éç¶²é æ‡‰ç”¨ç¨‹å¼ï¼ˆWeb Appï¼‰é ç«¯é™æ§ç¤¾å€å…§çš„å¤šå€‹å¤§é–€èˆ‡éµæ²é–€ã€‚

æœ¬å°ˆæ¡ˆçµåˆäº†ç‰©è¯ç¶²ç¡¬é«”ï¼ˆESP32ï¼‰ã€é›²ç«¯å¾Œç«¯æœå‹™ï¼ˆSupabaseï¼‰å’Œç¾ä»£ç¶²é æŠ€è¡“ï¼Œæ—¨åœ¨å–ä»£å‚³çµ±çš„å¯¦é«”é™æ§å™¨ï¼Œæä¾›ä¸€å€‹æ›´å®‰å…¨ã€æ–¹ä¾¿ä¸”æ˜“æ–¼ç®¡ç†çš„é–€ç¦è§£æ±ºæ–¹æ¡ˆã€‚

### ğŸ“¸ å°ˆæ¡ˆé è¦½

<table width="100%">
  <tr>
    <td width="50%" align="center"><b>ä½¿ç”¨è€…é™æ§å™¨ (ç™»å…¥/æ“ä½œ)</b></td>
    <td width="50%" align="center"><b>ç®¡ç†å“¡å¾Œå° (ä½æˆ¶åˆ—è¡¨/ç·¨è¼¯)</b></td>
  </tr>
  <tr>
    <td width="50%"><img src="image/preview-user-app.png" alt="ä½¿ç”¨è€… App é è¦½"></td>
    <td width="50%"><img src="image/preview-admin-app.png" alt="ç®¡ç†å“¡ App é è¦½"></td>
  </tr>
</table>

---

## âœ¨ ä¸»è¦åŠŸèƒ½

### ä½¿ç”¨è€…ç«¯
- **é ç«¯é–€ç¦æ§åˆ¶**: é€éæ‰‹æ©Ÿæˆ–é›»è…¦ç¶²é ï¼Œéš¨æ™‚éš¨åœ°æ§åˆ¶è»Šé“éµæ²é–€ã€å¤§é–€ç­‰ã€‚
- **Google å¸³è™Ÿç™»å…¥**: ä½¿ç”¨ Google OAuth é€²è¡Œå®‰å…¨å¿«é€Ÿçš„èº«ä»½é©—è­‰ã€‚
- **PWA æ”¯æ´**: å¯å°‡ç¶²é ã€Œå®‰è£ã€åˆ°æ‰‹æ©Ÿä¸»ç•«é¢ï¼Œæä¾›é¡ä¼¼åŸç”Ÿ App çš„é«”é©—ã€‚
- **ç›´è¦ºä»‹é¢**: ç°¡æ½”æ˜ç­çš„æŒ‰éˆ•èˆ‡ç‹€æ…‹æç¤ºï¼Œæ“ä½œç°¡å–®ã€‚
- **è·¨å¹³å°**: ç„¡éœ€å®‰è£ç‰¹å®š Appï¼Œä»»ä½•æœ‰ç€è¦½å™¨çš„è£ç½®éƒ½èƒ½ä½¿ç”¨ã€‚

### ç®¡ç†å“¡ç«¯
- **ç¨ç«‹ç®¡ç†å¾Œå°**: æä¾›å°ˆå±¬çš„ `admin.html` é é¢é€²è¡Œä½æˆ¶ç®¡ç†ã€‚
- **ä½æˆ¶æ¬Šé™ç®¡ç†**: è¼•é¬†æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ä½æˆ¶è³‡æ–™ã€‚
- **æ¬Šé™åˆ†ç´š**: å¯å°‡ç‰¹å®šä½¿ç”¨è€…è¨­å®šç‚ºã€Œç®¡ç†å“¡ã€ï¼Œå…±åŒç®¡ç†ç³»çµ±ã€‚
- **å¿«é€Ÿæœå°‹**: å¿«é€ŸæŸ¥æ‰¾ç‰¹å®šä½æˆ¶çš„è³‡æ–™ã€‚

### ç¡¬é«”ç«¯ (ESP32)
- **MQTT é€šè¨Š**: é€éè¼•é‡ç´šçš„ MQTT å”è­°æ¥æ”¶ä¾†è‡ªé›²ç«¯çš„æŒ‡ä»¤ï¼Œåæ‡‰å¿«é€Ÿã€‚
- **OTA ç„¡ç·šæ›´æ–°**: æ”¯æ´é ç«¯éŸŒé«”æ›´æ–°ï¼Œç„¡éœ€å¯¦é«”æ¥è§¸å³å¯éƒ¨ç½²æ–°åŠŸèƒ½æˆ–ä¿®å¾©éŒ¯èª¤ã€‚
- **é«˜ç©©å®šæ€§**: ESP32 æä¾›å¯é çš„ Wi-Fi é€£ç·šèˆ‡è™•ç†æ•ˆèƒ½ã€‚

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

æœ¬å°ˆæ¡ˆçš„é‹ä½œæµç¨‹å¦‚ä¸‹ï¼š

1.  **ä½¿ç”¨è€…**: åœ¨ `index.html` æˆ– `admin.html` é€é Google å¸³è™Ÿç™»å…¥ã€‚
2.  **å‰ç«¯ (JavaScript)**: å°‡ç™»å…¥è³‡è¨Šå‚³é€çµ¦ Supabase é€²è¡Œé©—è­‰ã€‚
3.  **å‰ç«¯ (JavaScript)**: é©—è­‰æˆåŠŸå¾Œï¼Œä½¿ç”¨è€…é»æ“Šæ“ä½œæŒ‰éˆ•ï¼Œå‘¼å«å¾Œç«¯çš„ Supabase Edge Functionã€‚
4.  **å¾Œç«¯ (Edge Function)**: å‡½æ•¸åœ¨å¾Œç«¯é©—è­‰ä½¿ç”¨è€…èº«ä»½ï¼Œç¢ºèªæ¬Šé™å¾Œï¼Œä»£æ›¿ä½¿ç”¨è€…ç™¼å¸ƒ MQTT æŒ‡ä»¤åˆ° Brokerã€‚
5.  **ç¡¬é«” (ESP32)**: æŒçºŒè¨‚é–± MQTT Broker ä¸Šçš„ç‰¹å®šä¸»é¡Œã€‚
6.  **ç¡¬é«” (ESP32)**: æ”¶åˆ°æŒ‡ä»¤å¾Œï¼Œè§¸ç™¼å°æ‡‰çš„ GPIO æ¥è…³ä¾†æ§åˆ¶ç¹¼é›»å™¨ã€‚

```mermaid
graph TD
    subgraph "ä½¿ç”¨è€…è£ç½®"
        A["Web App (index/admin.html)"]
    end

    subgraph "é›²ç«¯æœå‹™"
        B[Supabase Auth & DB]
        C[Supabase Edge Function]
        D["MQTT Broker (mqttgo.io)"]
    end

    subgraph "ç¤¾å€ç¾å ´"
        E[ESP32]
        F[ç¹¼é›»å™¨æ¨¡çµ„]
        G["éµæ²é–€/å¤§é–€é¦¬é”"]
    end

    A -- (1) Google ç™»å…¥ --> B
    B -- (2) é©—è­‰ Email & æ¬Šé™ --> A
    A -- (3) å‘¼å«å¾Œç«¯å‡½æ•¸(æŒ‡ä»¤) --> C
    C -- (4) ç™¼å¸ƒ MQTT æŒ‡ä»¤ --> D
    D -- (5) è½‰ç™¼æŒ‡ä»¤ --> E
    E -- (6) æ¥æ”¶æŒ‡ä»¤ --> F
    F -- (7) è§¸ç™¼æ§åˆ¶ --> G
```

---

## ğŸ› ï¸ æŠ€è¡“æ£§

- **ç¡¬é«”**: ESP32
- **éŸŒé«”**: C++ (Arduino Framework)
- **å‰ç«¯**: HTML, CSS, Vanilla JavaScript
- **å¾Œç«¯å³æœå‹™ (BaaS)**: Supabase (ç”¨æ–¼èº«ä»½é©—è­‰èˆ‡ PostgreSQL è³‡æ–™åº«)
- **é€šè¨Šå”å®š**: MQTT
- **åœ–ç¤ºåº«**: Material Design Icons

---

## ğŸš€ è¨­å®šèˆ‡éƒ¨ç½²

### 1. ç¡¬é«” (ESP32)

1.  **ç’°å¢ƒè¨­å®š**:
    - å®‰è£ Arduino IDE 2.0.0 åŠä»¥ä¸Šç‰ˆæœ¬ã€‚
    - åœ¨é–‹ç™¼ç’°å¢ƒä¸­åŠ å…¥ ESP32 é–‹ç™¼æ¿æ”¯æ´ï¼Œç‰ˆæœ¬ç‚º `2.0.11`ã€‚
    - å®‰è£å¿…è¦çš„å‡½å¼åº«ï¼š`PubSubClient`ã€`ArduinoOTA`ã€`WiFi.h` ç­‰ã€‚
2.  **ä¿®æ”¹æ†‘è­‰**:
    - æ‰“é–‹ `esp32_door_mqtt/credentials.h` æª”æ¡ˆã€‚
    - å¡«å…¥æ‚¨çš„ Wi-Fi SSIDã€å¯†ç¢¼ã€MQTT Broker è³‡è¨Šä»¥åŠ OTA æ›´æ–°å¯†ç¢¼ã€‚
    ```c++
    // esp32_door_mqtt/credentials.h
    const char* ssid     = "æ‚¨çš„ Wi-Fi åç¨±";
    const char* password = "æ‚¨çš„ Wi-Fi å¯†ç¢¼";
    const char* ota_password = "æ‚¨çš„ OTA æ›´æ–°å¯†ç¢¼";
    ```
3.  **ä¸Šå‚³éŸŒé«”**:
    - å°‡ ESP32 é€£æ¥åˆ°é›»è…¦ï¼Œé¸æ“‡æ­£ç¢ºçš„ COM Port èˆ‡é–‹ç™¼æ¿å‹è™Ÿã€‚
    - ç·¨è­¯ä¸¦ä¸Šå‚³ `esp32_door_mqtt/esp32_door_mqtt.ino` ç¨‹å¼ç¢¼ã€‚

<p align="center">
  <img src="image/hardware-setup.png" alt="ç¡¬é«”åœ–" width="400">
  <br>
  <em>ç¡¬é«”å®‰è£ç¤ºæ„åœ– (ESP32 + ç¹¼é›»å™¨)</em>
</p>

### 2. å¾Œç«¯ (Supabase)

1.  **å»ºç«‹å°ˆæ¡ˆ**: å‰å¾€ Supabase å»ºç«‹ä¸€å€‹æ–°å°ˆæ¡ˆã€‚
2.  **å»ºç«‹è³‡æ–™è¡¨**:
    - é€²å…¥ `Table Editor`ï¼Œå»ºç«‹ä¸€å€‹åç‚º `users` çš„è³‡æ–™è¡¨ã€‚
    - é€²å…¥ `SQL Editor`ï¼ŒåŸ·è¡Œ `supabase/migrations/20251016142044_remote_schema.sql` å’Œ `supabase/migrations/20251017133144_remote_schema.sql` çš„å…§å®¹ä¾†å»ºç«‹ `whitelist` è³‡æ–™è¡¨èˆ‡ç›¸é—œæ¬Šé™ç­–ç•¥ã€‚
    - æˆ–è€…ï¼Œæ‰‹å‹•å»ºç«‹ä¸€å€‹åç‚º `whitelist` çš„è³‡æ–™è¡¨ï¼Œæ¬„ä½å¦‚ä¸‹ï¼š
        - `id` (bigint, Primary Key, is identity)
        - `created_at` (timestamptz, é è¨­ `now()`)
        - `email` (text, Is Unique)
        - `is_admin` (bool, é è¨­ `false`)
        - `resident_id` (text, é è¨­ `'N/A'`)
3.  **å–å¾— API é‡‘é‘°**:
    - å‰å¾€ `Project Settings` > `API`ã€‚
    - è¤‡è£½ `Project URL` å’Œ `anon public` é‡‘é‘°ã€‚
4.  **è¨­å®š Google ç™»å…¥**:
    - å‰å¾€ `Authentication` > `Providers`ï¼Œå•Ÿç”¨ Google ä¸¦ä¾ç…§å®˜æ–¹æ–‡ä»¶è¨­å®šã€‚

### 3. å‰ç«¯ (Web App)

1.  **è¨­å®š Supabase é€£ç·š**:
    - åœ¨ `script.js` å’Œ `admin.js` çš„é–‹é ­ï¼Œæ‰¾åˆ° Supabase Client çš„åˆå§‹åŒ–å€å¡Šã€‚
    - å°‡æ‚¨å¾ Supabase è¤‡è£½çš„ `URL` å’Œ `anon` é‡‘é‘°è²¼ä¸Šã€‚
    ```javascript
    const { createClient } = supabase;
    const SUPABASE_URL = 'æ‚¨çš„_SUPABASE_URL';
    const SUPABASE_ANON_KEY = 'æ‚¨çš„_SUPABASE_ANON_KEY';
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    ```
2.  **éƒ¨ç½²ç¶²é **:
    - å°‡ `index.html`, `admin.html`, `style.css`, `script.js`, `admin.js` ä»¥åŠå…¶ä»–éœæ…‹è³‡æºï¼ˆå¦‚ icon, manifestï¼‰ä¸Šå‚³åˆ°ä»»ä½•éœæ…‹ç¶²ç«™è¨—ç®¡æœå‹™ï¼Œä¾‹å¦‚ GitHub Pages, Netlify, Vercel æˆ–æ‚¨è‡ªå·±çš„ä¼ºæœå™¨ã€‚

---

## ğŸ“‚ å°ˆæ¡ˆçµæ§‹

```text
.
â”œâ”€â”€ supabase/               # Supabase å¾Œç«¯è¨­å®š
â”‚   â”œâ”€â”€ functions/          # Edge Functions åŸå§‹ç¢¼
â”‚   â””â”€â”€ migrations/         # è³‡æ–™åº«é·ç§» (Schema) æª”æ¡ˆ
â”œâ”€â”€ esp32_door_mqtt/      # ESP32 éŸŒé«”ç›®éŒ„
â”‚   â”œâ”€â”€ esp32_door_mqtt.ino # ä¸»è¦ Arduino ç¨‹å¼ç¢¼
â”‚   â””â”€â”€ credentials.h       # Wi-Fi å’Œ MQTT æ†‘è­‰ (æ‡‰è¢« gitignore)
â”œâ”€â”€ admin.html            # ç®¡ç†å“¡å¾Œå°é é¢
â”œâ”€â”€ admin.js              # ç®¡ç†å“¡å¾Œå°çš„ JavaScript é‚è¼¯
â”œâ”€â”€ admin-manifest.json   # ç®¡ç†å“¡ PWA è¨­å®šæª”
â”œâ”€â”€ admin-icon.svg        # ç®¡ç†å“¡ App åœ–ç¤º
â”œâ”€â”€ index.html            # ä½¿ç”¨è€…é™æ§å™¨ä¸»é é¢
â”œâ”€â”€ script.js             # ä½¿ç”¨è€…ä¸»é é¢çš„ JavaScript é‚è¼¯
â”œâ”€â”€ manifest.json         # ä½¿ç”¨è€… PWA è¨­å®šæª”
â”œâ”€â”€ sw.js                 # PWA Service Worker è…³æœ¬ (å…±ç”¨)
â”œâ”€â”€ icon.svg              # ä½¿ç”¨è€… App åœ–ç¤º
â”œâ”€â”€ style.css             # å…±ç”¨çš„ CSS æ¨£å¼è¡¨
â”œâ”€â”€ VERSIONS.md           # å°ˆæ¡ˆç‰ˆæœ¬è³‡è¨Š
â””â”€â”€ README.md             # æœ¬æ–‡ä»¶
```